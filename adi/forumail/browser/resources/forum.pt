<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="context/main_template/macros/master"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n">
<metal:block fill-slot="content">
<tal:comment tal:replace="nothing">
'#category' and '.link-category' are used to inherit Plone-styles (SunburstTheme).
'.creation-date' was choosen instead of more convenient '.date', to *not* inherit Plone-styles (of jq-ui).
</tal:comment>
<div tal:define="portal_type context/Type;
     mtool nocall: context/portal_membership;
     search_url string:${context/@@plone_portal_state/navigation_root_url}/@@search;
     forum_url context/absolute_url;
     add_url string:${forum_url}/createObject?type_name=News%20Item;
     posts nocall: view/getPosts;
     isIniPost nocall: view/isIniPost;"
     tal:attributes="class string:forumail forum ${portal_type}">
    <tal:redefineForumUrlIfContextIsPost
        tal:condition="python: portal_type == 'News Item'"
        tal:define="forum_url python: '/'.join(forum_url.split('/')[:-1])">
    </tal:redefineForumUrlIfContextIsPost>
    <div class="head">
        <a class="add" href="./createObject?type_name=News%20Item">
+ Add new post
        </a>
        <div class="sorting">
            <div class="type">
                <a class="threads" href="#">
Threads
                </a>
                <a class="posts selected" href="#">
Posts
                </a>
            </div>
            <div class="criterion">
                <div class="newest selected">
Newest
                    <a class="thread" href="#">
Thread
                    </a>
                    <a class="post selected" href="#">
Post
                    </a>
                </div>
                <div class="author">
Author
                    <a class="thread" href="#">
Thread
                    </a>
                    <a class="post" href="#">
Post
                    </a>
                </div>
            </div>
        </div><!-- .sorting -->
    </div>
    <div class="posts" tal:repeat="post posts">
    <div class="post" tal:define="id post/id;
        title post/Title;
        categories post/Subject;
        author post/Creator;
        date post/CreationDate;
        date python: date[:10] + ' ' + date[12:16];
        url string:${forum_url}/${id};
        reply_url string:${add_url}&Title=${id};
        INI python: isIniPost(id);
        text python: post.getObject().getText();">
        <a tal:attributes="class string:field title; href string:${url}/forumail_view">
            <span tal:condition="INI" tal:replace="title">
Title
            </span>
            <span tal:condition="not: INI" tal:replace="id">
Id
            </span>
        </a>
        <div id="category" class="field categories" tal:condition="INI">
            <a class="link-category category link"
                tal:repeat="cat categories"
                tal:content="cat"
                tal:attributes="href string:${search_url}?Subject%3Alist=${cat};
                                title string:Go to all posts tagged with '${cat}';">
Category
            </a>
        </div>
        <span class="field creation-date" tal:content="date">
Date
        </span>
            <a class="author link;"
                tal:attributes="title string:Go to all posts of ${author};
                                href string:${search_url}?sort_on=Date&sort_order=reverse&Creator=${author};">
                <img class="avatar"
                    tal:define="portrait python: mtool.getPersonalPortrait(author);
                                portrait_url portrait/absolute_url;
                                is_default_img python: portrait_url.endswith('/defaultUser.png');"
                    tal:attributes="src string:${portrait_url}; alt string:\
Avatar of ${author}">
                <div tal:content="author">
Author
                </div>
            </a>
        <div class="body text" tal:replace="structure text">
Text
        </div>
        <a class="reply link"
         tal:define="
                     post_id post/id;
                     post_url string:${forum_url}/${post_id};
                     "
         tal:attributes='href reply_url;
                         title string:Reply to "${post_id}";'>
Reply
        </a>
    </div><tal:comment tal:replace="nothing">EO .post</tal:comment>
    </div><tal:comment tal:replace="nothing">EO .posts</tal:comment>
</div><tal:comment tal:replace="nothing">EO .forum</tal:comment>
</metal:block>
</html>

