<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="context/main_template/macros/master"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n">
<metal:block fill-slot="content">

<div class="forumail"
     tal:define="mtool nocall: context/portal_membership;">

<div class="posts"
     tal:define="posts nocall: view/getPosts;
                 is_thread python: context.Type() == 'News Item';
                 mtool nocall: context/portal_membership;">

<div class="post"
     tal:repeat="post posts">

     <div class="thread-head"
          tal:define="is_first repeat/post/start;
                      show_thread_head python: is_first and is_thread or not is_thread"
          tal:condition="show_thread_head">

        <div tal:define="categories post/Subject" id="category" class="categories">
            <a tal:repeat="cat categories"
               tal:content="cat"
               tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/@@search?Subject%3Alist=${cat};
                               title string:Click to see all posts tagged as #${cat};
                               alt string:${cat};"
               class="link-category">
Category
            </a>
        </div>

        <div tal:content="post/Title" class="title">
Title
        </div>
    </div><span tal:replace="nothing">EO .thread-head</span>

    <a tal:content="post/id" tal:condition="python: mtool.checkPermission('Add Page Templates', context)" tal:attributes="href string:./${post/id}; alt string:${post/id}" class="id edit">
Id
    </a>
    <a tal:define="author post/Creator;"
       tal:attributes="title string:See all posts of ${author};
       href string:${context/@@plone_portal_state/navigation_root_url}/@@search?sort_on=Date&sort_order=reverse&Creator=${author};
       alt string:Go to all posts of user '${author}';"
       class="author"><img tal:define="portrait python: mtool.getPersonalPortrait(author); portrait_url portrait/absolute_url" tal:attributes="
       src string:${portrait_url}; alt string:
Avatar
       " class="author-avatar">
    </a>
    <a tal:define="author post/Creator;"
       tal:content="author"
       tal:attributes="title string:See all posts of ${author};
       href string:${context/@@plone_portal_state/navigation_root_url}/@@search?sort_on=Date&sort_order=reverse&Creator=${author};
       alt string:Go to all posts of user '${author}';"
       class="author author-name">
Author
       </a>

        
        <span tal:content="post/CreationDate" class="creation-date">
Date
        </span>


    <div tal:content="structure post/getText" class="post-text text">
Text
    </div>
</div><span tal:replace="nothing">EO .post</span>
</div><span tal:replace="nothing">EO .posts</span>
</div><span tal:replace="nothing">EO .forumail</span>
</metal:block>
</html>

