<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="context/main_template/macros/master"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n">
<metal:block fill-slot="content">
<span tal:replace="nothing">
- '#category' and '.link-category' are used to inherit Plone-styles (SunburstTheme).
- .creation-date was choosen instead of more convenient '.date', 
  to *not* inherit Plone-styles (of jq-ui).
</span>
<div class="forumail"
     tal:define="mtool nocall: context/portal_membership;">
    <div class="head">
        <a class="add" href="./createObject?type_name=News%20Item">
+ Add new post
        </a>
    </div>
    <div class="posts" tal:define="posts nocall: view/getPosts;
                                   is_thread python: context.Type() == 'News Item';
                                   mtool nocall: context/portal_membership;">
    <div class="post" tal:repeat="post posts">
        <div class="thread-head"
             tal:define="is_first repeat/post/start;
                         show_thread_head python: is_first and is_thread or not is_thread"
             tal:condition="show_thread_head">

            <a class="field title" tal:content="post/Title" tal:attributes="href string: ${post/absolute_url}/forumail_view">
Title
            </a>
            <div id="category" class="field categories" tal:define="categories post/Subject">
                <a class="link-category category link"
                   tal:repeat="cat categories"
                   tal:content="cat"
                   tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/@@search?Subject%3Alist=${cat};
                                   title string:Click to 
                                   alt string:${cat};">
Category
                </a>
            </div>
        </div><!-- .thread-head -->
        <div class="head">
            <a class="field id" tal:content="post/id" tal:attributes="href string:./${post/id}/forumail_view; alt string:${post/id}">
Id
            </a>
            <span class="field creation-date"
                  tal:define="date post/CreationDate;
                              date python: date[:10] + ' ' + date[12:16];"
                  tal:content="date">
Date
            </span>
            <a class="author link"
               tal:define="author post/Creator;"
               tal:attributes="title string:See all posts of ${author};
               href string:${context/@@plone_portal_state/navigation_root_url}/@@search?sort_on=Date&sort_order=reverse&Creator=${author};
               alt string:Go to all posts of user '${author}';">
               <img class="avatar"
                    tal:define="portrait python: mtool.getPersonalPortrait(author);
                                portrait_url portrait/absolute_url;
                                portrait_url string:logo.png;"
                    tal:attributes="src string:${portrait_url}; alt string:
Avatar">
            </a>
            <a class="field author name"
               tal:define="author post/Creator;"
               tal:content="author"
               tal:attributes="title string:See all posts of ${author};
               href string:${context/@@plone_portal_state/navigation_root_url}/@@search?sort_on=Date&sort_order=reverse&Creator=${author};
               alt string:Go to all posts of user '${author}';">
Author
            </a>


        </div><!-- .head -->
        <div tal:content="structure post/getText" class="body text">
Text
        </div><!-- .body -->
        <div class="foot">
            <a class="reply-to link"
             tal:define="
                         post_id post/id;
                         post_url post/absolute_url;
                         forum_url python: '/'.join(post_url.split('/')[:-1]);
                         reply_url string:${forum_url}?reply_to_title=${post_id};
                         reply_url string:${forum_url}/createObject?type_name=News%20Item&Title=${post_id};
                         "
             tal:attributes="href reply_url;
                             alt string:Reply to ${post_id};">
Reply
            </a>
        </div><!-- .foot -->
        </div><!-- .post -->
    </div><!-- .posts -->
</div><!-- .forumail -->
</metal:block>
</html>

